<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>{{ project.name }}</title>
    <style>
      body { font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Arial; margin: 20px; }
      .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 12px; }
      .card { border: 1px solid #ddd; border-radius: 10px; padding: 12px; }
      img { width: 100%; height: auto; border-radius: 8px; border: 1px solid #eee; }
      textarea { width: 100%; min-height: 70px; }
      input[type=text], input[type=number], select { width: 100%; padding: 8px; }
      button { padding: 8px 12px; margin-top: 8px; }
      a { color: #0a58ca; text-decoration: none; }
      a:hover { text-decoration: underline; }
      .muted { color: #666; font-size: 12px; }
      code { background: #f6f6f6; padding: 2px 4px; border-radius: 6px; }
    </style>
  </head>
  <body>
    <p><a href="/">‚Üê projects</a></p>
    <h1>{{ project.name }}</h1>
    <p class="muted">Project ID: <code>{{ project.project_id }}</code></p>

    <div class="grid">
      <div class="card">
        <h2>Upload</h2>
        <form method="post" action="/projects/{{ project.project_id }}/assets/upload" enctype="multipart/form-data">
          <label>Kind</label>
          <select name="kind">
            <option value="reference">reference</option>
            <option value="product">product</option>
          </select>
          <div style="margin-top:8px;">
            <input type="file" name="file" accept="image/*" required />
          </div>
          <button type="submit">Upload</button>
        </form>
      </div>

      <div class="card">
        <h2>Observed profile (Gemini vision)</h2>
        <form method="post" action="/projects/{{ project.project_id }}/profile/propose">
          <label>Brief (optional)</label>
          <textarea name="brief_text" placeholder="Product, objective, tone..."></textarea>
          <button type="submit">Propose profile</button>
        </form>
        {% if observed_profile %}
          <details style="margin-top:10px;">
            <summary>View observed_profile</summary>
            <pre style="white-space: pre-wrap;">{{ observed_profile | tojson(indent=2) }}</pre>
          </details>
        {% endif %}
      </div>

      <div class="card">
        <h2>Generate KVs (Gemini image)</h2>
        <form method="post" action="/projects/{{ project.project_id }}/kvs/generate">
          <label>Prompt</label>
          <textarea name="prompt" required placeholder="e.g., lifestyle scene..."></textarea>
          <div style="display:flex; gap:10px; margin-top:8px;">
            <div style="flex:1;">
              <label>N</label>
              <input type="number" name="n" value="2" min="1" max="8" />
            </div>
            <div style="flex:1;">
              <label>Aspect ratio</label>
              <select name="aspect_ratio">
                <option value="1:1">1:1</option>
                <option value="4:5">4:5</option>
                <option value="9:16">9:16</option>
              </select>
            </div>
          </div>
          <button type="submit">Generate</button>
        </form>
      </div>

      <div class="card">
        <h2>Generate headlines (OpenAI text)</h2>
        <form method="post" action="/projects/{{ project.project_id }}/copy/headlines">
          <label>Brief</label>
          <textarea name="brief_text" required placeholder="Product details, offer, objective, constraints..."></textarea>
          <label>Count</label>
          <input type="number" name="count" value="10" min="3" max="30" />
          <button type="submit">Generate headlines</button>
        </form>
      </div>

      <div class="card">
        <h2>Build masters (Pillow)</h2>
        <form method="post" action="/projects/{{ project.project_id }}/masters/build">
          <label>KV</label>
          <select name="kv_asset_id" required>
            {% for kv in kvs %}
              <option value="{{ kv.asset_id }}">{{ kv.asset_id }} ({{ kv.filename }})</option>
            {% endfor %}
          </select>
          <label>Headline</label>
          <input type="text" name="headline" placeholder="Headline" required />
          <label>CTA</label>
          <input type="text" name="cta" value="Learn more" />
          <button type="submit">Build 3 ratios</button>
        </form>
        {% if not kvs %}
          <p class="muted">Generate a KV first.</p>
        {% endif %}
      </div>
    </div>

    <h2 style="margin-top:22px;">KVs</h2>
    {% if kvs %}
      <div class="grid">
        {% for a in kvs %}
          <div class="card">
            <img src="/projects/{{ project.project_id }}/assets/{{ a.asset_id }}" />
            <div class="muted">kv: <code>{{ a.asset_id }}</code></div>
          </div>
        {% endfor %}
      </div>
    {% else %}
      <p class="muted">No KVs yet.</p>
    {% endif %}

    <h2 style="margin-top:22px;">Masters</h2>
    {% if masters %}
      <div class="grid">
        {% for a in masters %}
          <div class="card">
            <img src="/projects/{{ project.project_id }}/assets/{{ a.asset_id }}" />
            <div class="muted">master: <code>{{ a.asset_id }}</code> ({{ a.metadata.ratio }})</div>
          </div>
        {% endfor %}
      </div>
    {% else %}
      <p class="muted">No masters yet.</p>
    {% endif %}

    <h2 style="margin-top:22px;">All assets</h2>
    {% if assets %}
      <div class="grid">
        {% for a in assets %}
          <div class="card">
            <div><code>{{ a.asset_id }}</code></div>
            <div class="muted">{{ a.kind }} - {{ a.filename }}</div>
            {% if a.filename.endswith('.png') or a.filename.endswith('.jpg') or a.filename.endswith('.jpeg') %}
              <div style="margin-top:8px;">
                <a href="/projects/{{ project.project_id }}/assets/{{ a.asset_id }}" target="_blank">open</a>
              </div>
            {% endif %}
          </div>
        {% endfor %}
      </div>
    {% endif %}
  </body>
</html>

